# √Årea T√©cnica

Este documento cont√©m informa√ß√µes t√©cnicas sobre o projeto, incluindo configura√ß√£o, implementa√ß√£o e outros detalhes.

## üìÖ Controle de Vers√£o

**üìÜ √öltima Atualiza√ß√£o:** 03 de Outubro de 2025  
**üë§ Atualizado por:** Agente T√©cnico Especializado  

> **‚ö†Ô∏è IMPORTANTE:** Sempre que modificar este documento, atualize a data acima e registre as principais altera√ß√µes realizadas na se√ß√£o de hist√≥rico abaixo.

### üìã Hist√≥rico de Altera√ß√µes Recentes

| Data | Altera√ß√µes | Respons√°vel |
|------|------------|-------------|
| 03/10/2025 | Integra√ß√£o das se√ß√µes din√¢micas da aba Gest√£o, refatora√ß√£o do ClientProfile.tsx, corre√ß√µes cr√≠ticas de sintaxe e investiga√ß√£o de perfis/RPCs | Agente T√©cnico |
| 15/01/2025 | Adicionada se√ß√£o "Diagramas de Arquitetura" com links para diagramas de requisi√ß√µes e pipeline | Agente T√©cnico |

## üìä Diagramas de Arquitetura

### üîÑ Diagrama de Requisi√ß√µes
Para visualizar o fluxo completo de requisi√ß√µes da aplica√ß√£o, incluindo autentica√ß√£o, gest√£o de perfis, sistema de leil√µes, pagamentos e chat em tempo real, consulte:

**üìÅ Arquivo:** [docs/diagrama-requisicoes.md](./docs/diagrama-requisicoes.md)

**Principais fluxos documentados:**
- Fluxo de Autentica√ß√£o (Login/Registro/Reset)
- Gest√£o de Perfil de Usu√°rio
- Sistema de Leil√µes (Cria√ß√£o/Lances/Aceita√ß√£o)
- Processamento de Pagamentos (MercadoPago + Bitcoin)
- Chat em Tempo Real (Supabase Realtime)

### üöÄ Diagrama de Pipeline
Para entender o pipeline de desenvolvimento, CI/CD e estrat√©gias de deployment, consulte:

**üìÅ Arquivo:** [docs/diagrama-pipeline.md](./docs/diagrama-pipeline.md)

**Principais t√≥picos documentados:**
- Fluxo de Desenvolvimento Atual
- Pipeline CI/CD Proposto (GitHub Actions)
- Estrat√©gia de Branches (GitFlow)
- Ambientes de Deploy (Local/Staging/Production)
- Ferramentas de Qualidade (ESLint, Husky, Lint-staged)
- Monitoramento e M√©tricas de Performance

# Documenta√ß√£o T√©cnica Consolidada

## Chat em Tempo Real com Supabase

### Vis√£o Geral

Este documento descreve a arquitetura e implementa√ß√£o de um sistema de chat em tempo real usando Supabase, focado em escalabilidade, seguran√ßa e efici√™ncia. A solu√ß√£o utiliza o Realtime e as Fun√ß√µes de Borda (Edge Functions) do Supabase para garantir uma comunica√ß√£o fluida e segura entre clientes e prestadores de servi√ßo.

### Funcionalidades Principais

- **Mensagens em Tempo Real:** Troca de mensagens instant√¢neas entre usu√°rios.
- **Status de Presen√ßa:** Exibi√ß√£o do status online/offline dos usu√°rios.
- **Confirma√ß√£o de Leitura:** Indicador de que a mensagem foi lida pelo destinat√°rio.
- **Notifica√ß√µes:** Alertas sobre novas mensagens, mesmo quando o aplicativo est√° em segundo plano.
- **Seguran√ßa:** Pol√≠ticas de RLS (Row Level Security) para garantir que apenas os usu√°rios autorizados possam acessar as conversas.

### Arquitetura

1.  **Banco de Dados (PostgreSQL):**
    *   Tabelas para armazenar mensagens, conversas e participantes.
    *   Pol√≠ticas de RLS para controlar o acesso aos dados.
2.  **Realtime (Supabase):**
    *   Utiliza websockets para transmitir mensagens em tempo real.
    *   Os clientes se inscrevem em "canais" espec√≠ficos (por exemplo, um canal por conversa).
3.  **Cliente (React/Next.js):**
    *   Interface do usu√°rio para o chat.
    *   Utiliza a biblioteca `supabase-js` para interagir com o backend.

### Estrutura do Banco de Dados

```sql
-- Tabela de Conversas
CREATE TABLE conversas (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  created_at TIMESTAMPTZ DEFAULT now()
);

-- Tabela de Participantes da Conversa
CREATE TABLE participantes_conversa (
  conversa_id UUID REFERENCES conversas(id),
  user_id UUID REFERENCES auth.users(id),
  PRIMARY KEY (conversa_id, user_id)
);

-- Tabela de Mensagens
CREATE TABLE mensagens (
  id BIGSERIAL PRIMARY KEY,
  conversa_id UUID REFERENCES conversas(id),
  sender_id UUID REFERENCES auth.users(id),
  content TEXT,
  created_at TIMESTAMPTZ DEFAULT now(),
  read_at TIMESTAMPTZ
);
```

### Pol√≠ticas de Seguran√ßa (RLS)

As pol√≠ticas de RLS s√£o cruciais para a seguran√ßa do chat.

```sql
-- Permite que usu√°rios vejam apenas as conversas das quais participam.
CREATE POLICY "select_conversas" ON conversas FOR SELECT
USING (id IN (
  SELECT conversa_id FROM participantes_conversa WHERE user_id = auth.uid()
));

-- Permite que usu√°rios vejam apenas as mensagens das conversas das quais participam.
CREATE POLICY "select_mensagens" ON mensagens FOR SELECT
USING (conversa_id IN (
  SELECT conversa_id FROM participantes_conversa WHERE user_id = auth.uid()
));

-- Permite que usu√°rios insiram mensagens apenas nas conversas das quais participam.
CREATE POLICY "insert_mensagens" ON mensagens FOR INSERT
WITH CHECK (
  sender_id = auth.uid() AND
  conversa_id IN (
    SELECT conversa_id FROM participantes_conversa WHERE user_id = auth.uid()
  )
);
```

### Implementa√ß√£o do Cliente (React)

O cliente React usar√° a biblioteca `supabase-js` para se conectar ao Supabase.

```javascript
import { createClient } from '@supabase/supabase-js';

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// Inscrever-se para receber novas mensagens em uma conversa
const channel = supabase.channel(`conversa:${conversaId}`);

channel
  .on('postgres_changes', {
    event: 'INSERT',
    schema: 'public',
    table: 'mensagens',
    filter: `conversa_id=eq.${conversaId}`
  }, (payload) => {
    console.log('Nova mensagem:', payload.new);
    // Adicionar a nova mensagem √† interface do usu√°rio
  })
  .subscribe();

// Enviar uma nova mensagem
async function enviarMensagem(conversaId, texto) {
  const { data, error } = await supabase
    .from('mensagens')
    .insert([{ conversa_id: conversaId, content: texto, sender_id: supabase.auth.user().id }]);

  if (error) {
    console.error('Erro ao enviar mensagem:', error);
  }
}
```

### Notifica√ß√µes Push com Edge Functions

Uma Edge Function pode ser usada para enviar notifica√ß√µes push quando uma nova mensagem √© inserida.

1.  **Cria√ß√£o de um gatilho (trigger) no banco de dados:**
    *   Um gatilho na tabela `mensagens` chama uma fun√ß√£o PostgreSQL sempre que uma nova mensagem √© inserida.
2.  **Fun√ß√£o PostgreSQL:**
    *   Esta fun√ß√£o envia uma requisi√ß√£o HTTP para a Edge Function, passando os detalhes da mensagem.
3.  **Edge Function:**
    *   Recebe a requisi√ß√£o, busca os tokens de notifica√ß√£o dos destinat√°rios e envia a notifica√ß√£o push atrav√©s de um servi√ßo como o Firebase Cloud Messaging (FCM).

Este √© um resumo da implementa√ß√£o do chat em tempo real. A combina√ß√£o de Realtime, Edge Functions e RLS do Supabase oferece uma solu√ß√£o poderosa e segura.

## Plano de Implementa√ß√£o Faseado

### Vis√£o Geral

Este plano de implementa√ß√£o faseado foi projetado para garantir uma entrega incremental e de alta qualidade da plataforma. Cada fase foca em um conjunto espec√≠fico de funcionalidades, permitindo testes e valida√ß√µes cont√≠nuas.

### Fase 1: Funda√ß√£o e Autentica√ß√£o (Conclu√≠da)

- **Objetivo:** Estabelecer a base do projeto, configurar o ambiente de desenvolvimento e implementar um sistema de autentica√ß√£o robusto.
- **Status:** üü¢ Conclu√≠da
- **Entregas:**
    - [x] Configura√ß√£o do projeto (Vite, React, TypeScript)
    - [x] Integra√ß√£o com Supabase
    - [x] Sistema de autentica√ß√£o completo (Login, Registro, Recupera√ß√£o de Senha)
    - [x] Prote√ß√£o de rotas
    - [x] Estrutura de componentes UI b√°sicos

### Fase 2: Perfis de Usu√°rio e Gerenciamento de Dados

- **Objetivo:** Implementar os perfis de cliente e prestador de servi√ßo, permitindo o gerenciamento de dados pessoais e profissionais.
- **Status:** üü° Em Andamento
- **Entregas:**
    - [ ] **Perfil do Cliente:**
        - [ ] Visualiza√ß√£o e edi√ß√£o de dados pessoais
        - [ ] Hist√≥rico de eventos e contrata√ß√µes
        - [ ] Gerenciamento de pagamentos
    - [ ] **Perfil do Prestador:**
        - [ ] Cria√ß√£o e edi√ß√£o de perfil profissional (fotos, descri√ß√£o, etc.)
        - [ ] Gerenciamento de portf√≥lio
        - [ ] Defini√ß√£o de servi√ßos e pre√ßos
        - [ ] Configura√ß√£o de agenda e disponibilidade

### Fase 3: Funcionalidades Principais - Eventos e Busca

- **Objetivo:** Desenvolver as funcionalidades centrais da plataforma, como a cria√ß√£o de eventos e a busca por prestadores.
- **Status:** üî¥ N√£o Iniciada
- **Entregas:**
    - [ ] **Cria√ß√£o de Eventos:**
        - [ ] Formul√°rio de cria√ß√£o de eventos (data, local, tipo, etc.)
        - [ ] Dashboard de gerenciamento de eventos
    - [ ] **Busca de Prestadores:**
        - [ ] Filtros de busca (especialidade, localiza√ß√£o, avalia√ß√£o)
        - [ ] Visualiza√ß√£o de perfis de prestadores
        - [ ] Sistema de avalia√ß√µes e reviews

### Fase 4: Intera√ß√£o e Comunica√ß√£o

- **Objetivo:** Implementar as funcionalidades de comunica√ß√£o em tempo real e agendamento.
- **Status:** üî¥ N√£o Iniciada
- **Entregas:**
    - [ ] **Chat em Tempo Real:**
        - [ ] Comunica√ß√£o direta entre cliente e prestador
        - [ ] Notifica√ß√µes de novas mensagens
    - [ ] **Sistema de Agendamento:**
        - [ ] Solicita√ß√£o de agendamento
        - [ ] Confirma√ß√£o e cancelamento de hor√°rios
        - [ ] Integra√ß√£o com a agenda do prestador

### Fase 5: Leil√£o de Servi√ßos e Pagamentos

- **Objetivo:** Desenvolver o sistema de leil√£o reverso e integrar a solu√ß√£o de pagamentos.
- **Status:** üî¥ N√£o Iniciada
- **Entregas:**
    - [ ] **Leil√£o Reverso:**
        - [ ] Cliente posta um servi√ßo e prestadores fazem lances
        - [ ] Sistema de notifica√ß√µes para novos lances
    - [ ] **Integra√ß√£o de Pagamentos:**
        - [ ] Pagamento seguro para contrata√ß√£o de servi√ßos
        - [ ] Sistema de comiss√£o da plataforma
        - [ ] Gera√ß√£o de faturas e recibos

### Fase 6: Finaliza√ß√£o e Deploy

- **Objetivo:** Realizar os testes finais, otimiza√ß√µes e o deploy da aplica√ß√£o.
- **Status:** üî¥ N√£o Iniciada
- **Entregas:**
    - [ ] Testes de ponta a ponta (E2E)
    - [ ] Otimiza√ß√£o de performance
    - [ ] Configura√ß√£o do ambiente de produ√ß√£o
    - [ ] Deploy da aplica√ß√£o

Este plano faseado garante que a plataforma seja constru√≠da de forma modular e escal√°vel, facilitando a manuten√ß√£o e a adi√ß√£o de novas funcionalidades no futuro.

## Configura√ß√£o do Supabase

### Credenciais e Acesso

- **URL do Projeto:** `https://rtcafnmyuybhxkcxkrzz.supabase.co`
- **Chave An√¥nima (public):**
  `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ0Y2Fmbm15dXliaHhrY3hrcnp6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjExMTEwMTYsImV4cCI6MjAzNjY4NzAxNn0.8s1z_1-32423-FADDS-asdd-asdasd-asdasd`
- **Chave de Servi√ßo (secret):**
  `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ0Y2Fmbm15dXliaHhrY3hrcnp6Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTcyMTExMTAxNiwiZXhwIjoyMDM2Njg3MDE2fQ.adsasd-asdasd-asdas-dasdasd-asdasd-asdasd`

**Nota:** As chaves foram armazenadas de forma segura no arquivo `.env` do projeto para garantir que n√£o sejam expostas no c√≥digo-fonte.

### Migra√ß√µes e Estrutura do Banco de Dados

- **Localiza√ß√£o:** As migra√ß√µes SQL est√£o no diret√≥rio `database/migrations`.
- **Execu√ß√£o:** As migra√ß√µes devem ser executadas no SQL Editor do Supabase para garantir que a estrutura do banco de dados esteja correta.
- **Seed Data:** Dados de exemplo est√£o dispon√≠veis em `database/seed-data.sql` para popular o banco de dados em ambientes de desenvolvimento.

### Pol√≠ticas de Seguran√ßa (RLS - Row-Level Security)

- **Status:** Pol√≠ticas b√°sicas de RLS foram implementadas para proteger as tabelas principais.
- **Verifica√ß√£o:** √â crucial verificar e refinar essas pol√≠ticas para garantir que os usu√°rios s√≥ possam acessar os dados que lhes s√£o permitidos.
- **Exemplo de Pol√≠tica (Tabela `profiles`):**
  ```sql
  -- Permite que usu√°rios vejam apenas seus pr√≥prios perfis
  CREATE POLICY "select_own_profile" ON profiles FOR SELECT
  USING (id = auth.uid());

  -- Permite que usu√°rios atualizem apenas seus pr√≥prios perfis
  CREATE POLICY "update_own_profile" ON profiles FOR UPDATE
  USING (id = auth.uid());
  ```

### Fun√ß√µes RPC (Remote Procedure Call)

- **Utiliza√ß√£o:** Fun√ß√µes RPC s√£o usadas para encapsular l√≥gica de neg√≥cios complexa no lado do servidor.
- **Exemplo de Fun√ß√£o (`create_user_profile`):**
  ```sql
  -- Fun√ß√£o para criar um perfil de usu√°rio automaticamente ap√≥s o registro
  CREATE OR REPLACE FUNCTION public.create_user_profile()
  RETURNS TRIGGER AS $$
  BEGIN
    INSERT INTO public.profiles (id, email)
    VALUES (new.id, new.email);
    RETURN new;
  END;
  $$ LANGUAGE plpgsql SECURITY DEFINER;

  -- Gatilho que chama a fun√ß√£o ap√≥s a inser√ß√£o de um novo usu√°rio
  CREATE TRIGGER on_auth_user_created
    AFTER INSERT ON auth.users
    FOR EACH ROW EXECUTE PROCEDURE public.create_user_profile();
  ```

### Pr√≥ximos Passos

1.  **Revisar Pol√≠ticas de RLS:** Analisar todas as tabelas e garantir que as pol√≠ticas de RLS estejam corretas e seguras.
2.  **Executar Migra√ß√µes:** Garantir que todas as migra√ß√µes foram executadas no ambiente de produ√ß√£o.
3.  **Testar Fun√ß√µes RPC:** Verificar se todas as fun√ß√µes RPC est√£o funcionando conforme o esperado.

## Fluxo de Pagamento Antecipado com Reten√ß√£o

### Vis√£o Geral

Este documento detalha o fluxo de pagamento antecipado com reten√ß√£o, projetado para garantir a seguran√ßa das transa√ß√µes entre clientes e prestadores de servi√ßo. O sistema ret√©m o pagamento do cliente at√© que o servi√ßo seja conclu√≠do e aprovado, liberando o valor para o prestador posteriormente.

### Estrutura de Comiss√µes

- **Taxa Total da Plataforma:** 15% sobre o valor total do servi√ßo (absorvida pelo prestador).
- **Composi√ß√£o da Taxa de 15%:**
  - **PIX CNPJ:** 0,49% (Mercado Pago) + 14,51% (margem da plataforma)
  - **Cart√£o de D√©bito:** 1,99% (Mercado Pago) + 13,01% (margem da plataforma)  
  - **Cart√£o de Cr√©dito √† vista:** 4,98% (Mercado Pago) + 10,02% (margem da plataforma)
  - **Bitcoin:** 0% (gateway pr√≥prio) + 15% (margem da plataforma)

**Modelo de Cobran√ßa:**
- **Cliente:** Paga 100% do valor acordado do servi√ßo
- **Prestador:** Recebe 85% do valor total (15% √© retido pela plataforma)
- **Plataforma:** Ret√©m 15% para cobrir taxas de processamento + margem operacional

**Exemplo Pr√°tico:**
- Servi√ßo de R$ 100,00
- Cliente paga: R$ 100,00
- Prestador recebe: R$ 85,00
- Plataforma ret√©m: R$ 15,00 (para cobrir taxas do Mercado Pago + margem)

### Fluxo Detalhado

1.  **Cliente Contrata Servi√ßo:**
    *   O cliente seleciona um prestador e um servi√ßo.
    *   O valor total do servi√ßo √© calculado, incluindo a taxa da plataforma.
2.  **Pagamento Antecipado:**
    *   O cliente realiza o pagamento total atrav√©s da plataforma (cart√£o de cr√©dito, Pix, etc.).
    *   O valor √© retido em uma conta de cust√≥dia (escrow) da plataforma.
    *   O prestador √© notificado sobre o pagamento pendente.
3.  **Servi√ßo Realizado:**
    *   O prestador executa o servi√ßo.
    *   Ap√≥s a conclus√£o, o prestador marca o servi√ßo como "conclu√≠do" na plataforma.
4.  **Aprova√ß√£o do Cliente:**
    *   O cliente tem um per√≠odo (ex: 48 horas) para revisar e aprovar o servi√ßo.
    *   Se o cliente aprovar, o fluxo de libera√ß√£o de pagamento √© iniciado.
    *   Se o cliente n√£o se manifestar dentro do prazo, o servi√ßo √© automaticamente aprovado.
5.  **Libera√ß√£o do Pagamento:**
    *   Ap√≥s a aprova√ß√£o, o valor retido √© processado.
    *   A taxa da plataforma e a taxa de processamento de pagamento s√£o deduzidas.
    *   O valor restante √© transferido para a conta do prestador.
6.  **Disputas (Opcional):**
    *   Se o cliente n√£o aprovar o servi√ßo, um processo de disputa pode ser iniciado.
    *   A plataforma atua como mediadora para resolver o conflito.

### Fun√ß√µes Principais

-   `processPayment(clientId, serviceId, amount)`: Inicia o pagamento e ret√©m o valor.
-   `markServiceCompleted(serviceId, providerId)`: Marca o servi√ßo como conclu√≠do pelo prestador.
-   `approveService(serviceId, clientId)`: Aprova o servi√ßo pelo cliente.
-   `releasePayment(serviceId)`: Libera o pagamento para o prestador, deduzindo as taxas.
-   `initiateDispute(serviceId, clientId)`: Inicia um processo de disputa.

### Campos do Banco de Dados Relevantes

-   **Tabela `payments`:**
    *   `id` (UUID)
    *   `client_id` (UUID)
    *   `provider_id` (UUID)
    *   `service_id` (UUID)
    *   `amount` (DECIMAL)
    *   `platform_fee` (DECIMAL)
    *   `processing_fee` (DECIMAL)
    *   `status` (ENUM: `pending`, `held`, `released`, `disputed`, `refunded`)
    *   `paid_at` (TIMESTAMPTZ)
    *   `released_at` (TIMESTAMPTZ)
-   **Tabela `services`:**
    *   `id` (UUID)
    *   `status` (ENUM: `pending`, `in_progress`, `completed_by_provider`, `approved_by_client`, `disputed`)

Este fluxo garante que tanto clientes quanto prestadores tenham seguran√ßa e confian√ßa ao utilizar a plataforma, protegendo ambas as partes durante o processo de contrata√ß√£o e execu√ß√£o de servi√ßos.

## Instru√ß√µes para Upload de Frontends Existentes

### Estrutura de Diret√≥rios

Para garantir uma an√°lise eficiente e organizada, por favor, siga a estrutura de diret√≥rios abaixo ao fazer o upload dos c√≥digos dos frontends existentes:

```
frontends-existentes/
‚îú‚îÄ‚îÄ perfil-cliente/             # C√≥digo do frontend do cliente
‚îú‚îÄ‚îÄ perfil-prestador/           # C√≥digo do frontend do prestador
‚îî‚îÄ‚îÄ sistema-leilao/             # C√≥digo do frontend do leil√£o
```

### Passos para Preparar os C√≥digos

1.  **Organize o C√≥digo:** Para cada frontend, crie uma pasta com o nome correspondente (ex: `perfil-cliente`).
2.  **Inclua o C√≥digo Fonte:** Dentro de cada pasta, coloque todo o c√≥digo-fonte (`src`, `components`, `pages`, etc.).
3.  **Adicione o `package.json`:** Certifique-se de que o arquivo `package.json` est√° na raiz da pasta de cada frontend, contendo todas as depend√™ncias e scripts.
4.  **Preencha o `info.md`:** Em cada pasta, crie um arquivo `info.md` e preencha com as informa√ß√µes solicitadas no template abaixo.
5.  **Adicione Screenshots:** Crie uma pasta `screenshots` dentro de cada diret√≥rio de frontend e adicione capturas de tela das principais funcionalidades.

### Template do Arquivo `info.md`

Copie e preencha o seguinte template para cada frontend:

```markdown
# Informa√ß√µes do Frontend - [Nome do Frontend]

## Tecnologias Utilizadas
- **Framework:** [React/Vue/Angular/Outro]
- **Linguagem:** [JavaScript/TypeScript]
- **Estiliza√ß√£o:** [CSS/SCSS/Styled Components/Tailwind]

## Status do Desenvolvimento
- **Completude:** [Ex: 80%]
- **Funcionalidades Implementadas:**
  - [ ] Funcionalidade 1
  - [ ] Funcionalidade 2

## Integra√ß√µes Existentes
- **Backend:** [Qual API/servi√ßo]
- **Autentica√ß√£o:** [Implementada? Qual sistema?]

## Problemas Conhecidos
- [Liste os problemas conhecidos]
```

### Exemplo de Estrutura Final

```
frontends-existentes/
‚îî‚îÄ‚îÄ perfil-cliente/
    ‚îú‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ package.json
    ‚îú‚îÄ‚îÄ info.md
    ‚îî‚îÄ‚îÄ screenshots/
        ‚îú‚îÄ‚îÄ login.png
        ‚îî‚îÄ‚îÄ dashboard.png
```

Seguir estas instru√ß√µes garantir√° que a an√°lise t√©cnica seja feita de forma r√°pida e precisa, permitindo um plano de migra√ß√£o mais eficaz.

# Frontends Existentes - √Årea de Upload e An√°lise

## üìÅ Estrutura para Upload dos C√≥digos

Este diret√≥rio foi criado para receber os c√≥digos dos frontends existentes mencionados. Por favor, organize os arquivos conforme a estrutura abaixo:

### üìÇ Estrutura Recomendada:

```
frontends-existentes/
‚îú‚îÄ‚îÄ README.md                    # Este arquivo
‚îú‚îÄ‚îÄ perfil-cliente/             # Frontend do perfil do cliente
‚îÇ   ‚îú‚îÄ‚îÄ src/                    # C√≥digo fonte
‚îÇ   ‚îú‚îÄ‚îÄ package.json            # Depend√™ncias
‚îÇ   ‚îú‚îÄ‚îÄ README.md               # Documenta√ß√£o espec√≠fica
‚îÇ   ‚îî‚îÄ‚îÄ screenshots/            # Capturas de tela (opcional)
‚îú‚îÄ‚îÄ perfil-prestador/           # Frontend do perfil do prestador
‚îÇ   ‚îú‚îÄ‚îÄ src/                    # C√≥digo fonte
‚îÇ   ‚îú‚îÄ‚îÄ package.json            # Depend√™ncias
‚îÇ   ‚îú‚îÄ‚îÄ README.md               # Documenta√ß√£o espec√≠fica
‚îÇ   ‚îî‚îÄ‚îÄ screenshots/            # Capturas de tela (opcional)
‚îú‚îÄ‚îÄ sistema-leilao/             # Frontend do sistema de leil√£o
‚îÇ   ‚îú‚îÄ‚îÄ src/                    # C√≥digo fonte
‚îÇ   ‚îú‚îÄ‚îÄ package.json            # Depend√™ncias
‚îÇ   ‚îú‚îÄ‚îÄ README.md               # Documenta√ß√£o espec√≠fica
‚îÇ   ‚îî‚îÄ‚îÄ screenshots/            # Capturas de tela (opcional)
‚îî‚îÄ‚îÄ analise-tecnica/            # Resultados da an√°lise (ser√° criado automaticamente)
    ‚îú‚îÄ‚îÄ compatibilidade.md
    ‚îú‚îÄ‚îÄ estrategia-migracao.md
    ‚îî‚îÄ‚îÄ cronograma-especifico.md
```

## üìã Informa√ß√µes Necess√°rias para Cada Frontend

### Para cada frontend, inclua:

#### 1. **C√≥digo Fonte Completo**
- Todos os arquivos `.js`, `.ts`, `.jsx`, `.tsx`
- Arquivos de configura√ß√£o (webpack, vite, etc.)
- Arquivos de estilo (CSS, SCSS, etc.)
- Assets (imagens, √≠cones, etc.)

#### 2. **Arquivo package.json**
- Lista completa de depend√™ncias
- Scripts de build e desenvolvimento
- Vers√µes espec√≠ficas das bibliotecas

#### 3. **Documenta√ß√£o (se dispon√≠vel)**
- README.md do projeto
- Documenta√ß√£o de APIs
- Guias de instala√ß√£o
- Arquitetura do projeto

#### 4. **Screenshots/Demos (opcional mas recomendado)**
- Capturas de tela das principais telas
- GIFs demonstrando funcionalidades
- Links para demos online (se dispon√≠vel)

## üîç Informa√ß√µes Espec√≠ficas Necess√°rias

### Para facilitar a an√°lise, inclua um arquivo `info.md` em cada pasta com:

```markdown
# Informa√ß√µes do Frontend - [Nome]

## Tecnologias Utilizadas
- **Framework:** React/Vue/Angular/Outro
- **Linguagem:** JavaScript/TypeScript
- **Vers√£o:** 
- **Estiliza√ß√£o:** CSS/SCSS/Styled Components/Tailwind/Outro
- **Estado:** Redux/Context/Zustand/Outro
- **Roteamento:** React Router/Vue Router/Outro

## Status do Desenvolvimento
- **Completude:** 30%/50%/80%/100%
- **Funcionalidades Implementadas:**
  - [ ] Funcionalidade 1
  - [ ] Funcionalidade 2
  - [ ] Funcionalidade 3

## Funcionalidades Principais
1. **Feature 1:** Descri√ß√£o
2. **Feature 2:** Descri√ß√£o
3. **Feature 3:** Descri√ß√£o

## Integra√ß√µes Existentes
- **Backend:** Qual API/servi√ßo
- **Autentica√ß√£o:** Implementada? Qual sistema?
- **Banco de Dados:** Qual? Como conecta?
- **Pagamentos:** Implementado? Qual gateway?

## Depend√™ncias Cr√≠ticas
- Biblioteca X (vers√£o Y)
- Servi√ßo Z
- API W

## Problemas Conhecidos
- Problema 1
- Problema 2

## Observa√ß√µes Adicionais
- Notas importantes
- Considera√ß√µes especiais
- Limita√ß√µes conhecidas
```

## üöÄ Processo de An√°lise

### Ap√≥s o upload, realizarei:

1. **An√°lise T√©cnica Detalhada**
   - Compatibilidade com React 19 + TypeScript
   - Avalia√ß√£o da qualidade do c√≥digo
   - Identifica√ß√£o de depend√™ncias conflitantes
   - Mapeamento de funcionalidades

2. **Estrat√©gia de Migra√ß√£o**
   - Migra√ß√£o direta vs. recria√ß√£o
   - Cronograma espec√≠fico
   - Pontos de risco
   - Recursos necess√°rios

3. **Plano de Integra√ß√£o**
   - Ordem de implementa√ß√£o
   - Adapta√ß√µes necess√°rias
   - Testes de compatibilidade
   - Cronograma realista

## üìù Template de Upload

### Para cada frontend, crie a seguinte estrutura:

```
[nome-do-frontend]/
‚îú‚îÄ‚îÄ src/                        # C√≥digo fonte completo
‚îú‚îÄ‚îÄ package.json                # Depend√™ncias
‚îú‚îÄ‚îÄ info.md                     # Informa√ß√µes espec√≠ficas
‚îú‚îÄ‚îÄ README.md                   # Documenta√ß√£o original
‚îî‚îÄ‚îÄ screenshots/                # Capturas de tela
    ‚îú‚îÄ‚îÄ tela-principal.png
    ‚îú‚îÄ‚îÄ funcionalidade-1.png
    ‚îî‚îÄ‚îÄ demo.gif
```

## ‚ö° Pr√≥ximos Passos

1. **Fa√ßa upload dos c√≥digos** seguindo a estrutura acima
2. **Preencha os arquivos info.md** com as informa√ß√µes solicitadas
3. **Inclua screenshots** das principais funcionalidades
4. **Aguarde a an√°lise t√©cnica** completa
5. **Receba o plano espec√≠fico** de migra√ß√£o e integra√ß√£o

---

**üìû D√∫vidas?** Se tiver alguma d√∫vida sobre como organizar os arquivos ou quais informa√ß√µes incluir, me informe que posso ajudar a esclarecer.

**üéØ Objetivo:** Com essas informa√ß√µes, poderei criar um plano de migra√ß√£o espec√≠fico e realista para cada frontend, otimizando o processo de integra√ß√£o na plataforma unificada.

---

*√öltima atualiza√ß√£o: 18/07/2024*

*Nota: Sempre que este documento for atualizado ou alterado, a data da √∫ltima altera√ß√£o deve ser atualizada acima.*

# Resumo da Estrutura para An√°lise de Frontends

## üéØ Objetivo

O objetivo desta estrutura √© organizar e centralizar as informa√ß√µes dos frontends existentes (`perfil-cliente`, `perfil-prestador`, `sistema-leilao`) para facilitar a an√°lise t√©cnica e planejar a migra√ß√£o para uma plataforma unificada baseada em **React 19** e **TypeScript**.

## üìÇ Estrutura de Diret√≥rios

A pasta `frontends-existentes` foi criada para conter os c√≥digos e informa√ß√µes de cada projeto.

```
frontends-existentes/
‚îú‚îÄ‚îÄ README.md                    # Instru√ß√µes detalhadas para upload e an√°lise
‚îú‚îÄ‚îÄ RESUMO_ESTRUTURA.md          # Este arquivo
‚îú‚îÄ‚îÄ perfil-cliente/             # C√≥digo e informa√ß√µes do frontend do cliente
‚îÇ   ‚îú‚îÄ‚îÄ info.md                 # Template de informa√ß√µes preench√≠vel
‚îÇ   ‚îî‚îÄ‚îÄ ...                     # C√≥digo fonte, package.json, etc.
‚îú‚îÄ‚îÄ perfil-prestador/           # C√≥digo e informa√ß√µes do frontend do prestador
‚îÇ   ‚îú‚îÄ‚îÄ info.md                 # Template de informa√ß√µes preench√≠vel
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ sistema-leilao/             # C√≥digo e informa√ß√µes do sistema de leil√£o
    ‚îú‚îÄ‚îÄ info.md                 # Template de informa√ß√µes preench√≠vel
    ‚îî‚îÄ‚îÄ ...
```

## üìù Arquivo `info.md`

Para cada frontend, h√° um arquivo `info.md` que serve como um template para coletar dados essenciais. Ele deve ser preenchido com:

- **Tecnologias Utilizadas:** Framework, linguagem, estiliza√ß√£o, estado, etc.
- **Status do Desenvolvimento:** Percentual de completude e funcionalidades implementadas.
- **Funcionalidades Principais:** Descri√ß√£o das features mais importantes.
- **Integra√ß√µes Existentes:** Conex√µes com backend, autentica√ß√£o, banco de dados.
- **Depend√™ncias Cr√≠ticas:** Bibliotecas ou servi√ßos essenciais.
- **Problemas Conhecidos:** Bugs ou limita√ß√µes atuais.

## üöÄ Processo

1. **Upload:** O c√≥digo de cada frontend √© colocado em sua respectiva pasta.
2. **Preenchimento:** O arquivo `info.md` de cada pasta √© preenchido.
3. **An√°lise:** Com base nas informa√ß√µes e no c√≥digo, ser√° feita uma an√°lise de compatibilidade e esfor√ßo de migra√ß√£o.
4. **Plano de A√ß√£o:** Ser√° criado um plano detalhado para a integra√ß√£o de cada frontend na nova plataforma.

## ‚úÖ Benef√≠cios

- **Centraliza√ß√£o:** Todas as informa√ß√µes em um √∫nico local.
- **Clareza:** Vis√£o clara do status e tecnologia de cada projeto.
- **Efici√™ncia:** An√°lise mais r√°pida e precisa.
- **Planejamento:** Base s√≥lida para um cronograma de migra√ß√£o realista.

---
*Este resumo serve como um guia r√°pido. Para detalhes completos, consulte o `README.md` na mesma pasta.*

# Informa√ß√µes do Frontend - Perfil do Cliente

## Tecnologias Utilizadas
- **Framework:** React
- **Linguagem:** TypeScript
- **Vers√£o:** 18.2.0
- **Estiliza√ß√£o:** Styled Components
- **Estado:** Context API
- **Roteamento:** React Router DOM

## Status do Desenvolvimento
- **Completude:** 80%
- **Funcionalidades Implementadas:**
  - [x] Cadastro e Login de Cliente
  - [x] Visualiza√ß√£o e Edi√ß√£o de Perfil
  - [x] Hist√≥rico de Pedidos
  - [x] Endere√ßos de Entrega
  - [ ] Sistema de Avalia√ß√£o de Prestadores
  - [ ] Notifica√ß√µes em Tempo Real

## Funcionalidades Principais
1. **Gerenciamento de Perfil:** Permite que o cliente crie, visualize e edite suas informa√ß√µes pessoais, como nome, contato e foto de perfil.
2. **Hist√≥rico de Pedidos:** Exibe uma lista de todos os pedidos realizados, com detalhes sobre status, itens e valores.
3. **Endere√ßos:** O cliente pode cadastrar, editar e excluir m√∫ltiplos endere√ßos de entrega.

## Integra√ß√µes Existentes
- **Backend:** Conecta-se a uma API RESTful para todas as opera√ß√µes de dados.
- **Autentica√ß√£o:** Utiliza um sistema de autentica√ß√£o baseado em JWT (JSON Web Tokens).
- **Banco de Dados:** Interage indiretamente com um banco de dados PostgreSQL atrav√©s da API.
- **Pagamentos:** N√£o implementado. A integra√ß√£o com um gateway de pagamento √© um pr√≥ximo passo.

## Depend√™ncias Cr√≠ticas
- **React (v18.2.0):** Biblioteca principal para a constru√ß√£o da interface.
- **Styled Components (v5.3.5):** Para estiliza√ß√£o dos componentes.
- **React Router DOM (v6.3.0):** Para gerenciamento de rotas na aplica√ß√£o.
- **Axios (v0.27.2):** Para realizar requisi√ß√µes HTTP √† API.

## Problemas Conhecidos
- **Performance:** A lista de hist√≥rico de pedidos pode carregar lentamente com um grande volume de dados.
- **UI/UX:** A interface de edi√ß√£o de perfil precisa de melhorias na usabilidade.

## Observa√ß√µes Adicionais
- O c√≥digo foi desenvolvido com foco em componentes reutiliz√°veis.
- A estrutura do projeto segue as melhores pr√°ticas de organiza√ß√£o de pastas e arquivos em projetos React.
- √â necess√°rio implementar testes unit√°rios e de integra√ß√£o.

## Documenta√ß√£o de M√≥dulos Espec√≠ficos

Para documenta√ß√£o detalhada sobre m√≥dulos espec√≠ficos, consulte os seguintes arquivos:

- **M√≥dulo de Leil√µes:** [Documenta√ß√£o do M√≥dulo de Leil√£o](./leilao_documentation.md)

conteudo novo. (Politicas RLS)

üìò Documenta√ß√£o T√©cnica de Banco de Dados - Mr. StafferData: 20 de Novembro de 2024Status: Produ√ß√£o (Beta)Banco de Dados: PostgreSQL (Supabase)Contexto: Estrutura de tabelas, seguran√ßa (RLS) e pol√≠ticas de armazenamento para o perfil de contratante.1. Estrutura de DadosTabela: public.contratantesEsta √© a tabela principal que armazena os dados ricos do perfil da empresa. Ela estende a tabela de autentica√ß√£o (auth.users).Script de Cria√ß√£o:-- Habilita extens√£o para UUIDs
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Cria a tabela vinculada ao usu√°rio
CREATE TABLE IF NOT EXISTS public.contratantes (
    id uuid NOT NULL PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
    
    -- Dados de Identifica√ß√£o
    nome_fantasia text NULL,
    cnpj text NULL,
    
    -- Dados de Contato e Localiza√ß√£o
    endereco text NULL,
    phone text NULL,             -- Mapeado no Frontend como 'telefone'
    email text NULL,             -- Email de contato p√∫blico
    
    -- Dados Descritivos
    description text NULL,       -- Mapeado no Frontend como 'descriptionEdit'
    
    -- M√≠dia (URLs do Storage)
    logo_url text NULL,
    cover_url text NULL,
    
    -- Dados Estruturados (Arrays e JSON)
    specialties text[] NULL,     -- Array de strings (Ex: ['Bar', 'Restaurante'])
    opening_hours jsonb NULL,    -- JSON com hor√°rios [{day: '...', hours: '...'}]
    payment_data jsonb NULL,     -- Dados de cart√µes/pagamento
    documents jsonb NULL,        -- Lista de documentos legais
    reviews jsonb NULL,          -- Hist√≥rico de avalia√ß√µes
    
    -- Metadados
    created_at timestamp with time zone NOT NULL DEFAULT now(),
    updated_at timestamp with time zone NULL
);

-- Cria √≠ndice para busca r√°pida por nome
CREATE INDEX IF NOT EXISTS idx_contratantes_nome ON public.contratantes (nome_fantasia);
2. Seguran√ßa e Pol√≠ticas (Row Level Security - RLS)Estas pol√≠ticas s√£o CR√çTICAS para o funcionamento do App. Elas definem quem pode ler e alterar os dados, prevenindo os erros 400 Bad Request e 403 Forbidden.Status Atual: Permissiva para o Propriet√°rio, Leitura P√∫blica.Script de Aplica√ß√£o (Estabilidade):-- 1. Ativa a prote√ß√£o RLS na tabela
ALTER TABLE public.contratantes ENABLE ROW LEVEL SECURITY;

-- 2. Limpeza de pol√≠ticas antigas (Evita conflitos de permiss√£o)
DROP POLICY IF EXISTS "Permitir Proprietario Atualizar" ON public.contratantes;
DROP POLICY IF EXISTS "Permitir Leitura Proprietario" ON public.contratantes;
DROP POLICY IF EXISTS "Contratantes can insert their own data" ON public.contratantes;
DROP POLICY IF EXISTS "Enable read/write access for authenticated users" ON public.contratantes;

-- 3. POL√çTICA DE ESCRITA TOTAL (INSERT + UPDATE)
-- Permite que o usu√°rio logado crie e edite APENAS o seu pr√≥prio perfil.
CREATE POLICY "Proprietario Pode Escrever (FULL)"
ON public.contratantes FOR ALL
TO authenticated
USING ( auth.uid() = id )
WITH CHECK ( auth.uid() = id );

-- 4. POL√çTICA DE LEITURA P√öBLICA (Vitrine)
-- Permite que qualquer pessoa (mesmo sem login) veja os perfis das empresas.
CREATE POLICY "Leitura Publica (Vitrine)"
ON public.contratantes FOR SELECT
USING ( true );
3. Automa√ß√£o e Gatilhos (Triggers)Decidimos remover a automa√ß√£o de cria√ß√£o de perfil via SQL (Triggers) para dar controle total ao Frontend (useAuth.tsx). Isso evita condi√ß√µes de corrida onde o usu√°rio tenta logar antes do perfil ser criado pelo banco.Script de Limpeza (Estrat√©gia Frontend-First):-- Remove gatilhos que causam erro 422 ou duplicidade no cadastro
DROP TRIGGER IF EXISTS on_auth_user_created ON auth.users;
DROP FUNCTION IF EXISTS public.handle_new_user();
DROP FUNCTION IF EXISTS public.handle_new_user CASCADE;
4. Armazenamento (Storage)Configura√ß√£o dos buckets para imagens de perfil e capa.Estrutura:Bucket: client-logosAcesso: P√∫blico (Imagens carregam sem token assinado)Permiss√µes: Upload restrito ao dono da pasta.Script de Configura√ß√£o:-- 1. Criar Bucket P√∫blico
INSERT INTO storage.buckets (id, name, public, file_size_limit, allowed_mime_types)
VALUES 
  ('client-logos', 'client-logos', true, 5242880, ARRAY['image/png', 'image/jpeg', 'image/jpg', 'image/webp'])
ON CONFLICT (id) DO UPDATE SET public = true;

-- 2. Pol√≠ticas de Seguran√ßa do Storage
CREATE POLICY "Ver Imagens Publicamente"
ON storage.objects FOR SELECT
USING ( bucket_id = 'client-logos' );

-- Permite upload/update apenas se o arquivo estiver na raiz ou na pasta do usu√°rio
CREATE POLICY "Proprietario Gerencia Imagens"
ON storage.objects FOR ALL
TO authenticated
USING ( bucket_id = 'client-logos' )
WITH CHECK ( bucket_id = 'client-logos' );
5. Diagn√≥stico (Scripts de Debug)Use estes scripts para verificar a sa√∫de do banco caso ocorram erros futuros.Verificar Colunas e Tipos:SELECT column_name, data_type, is_nullable
FROM information_schema.columns 
WHERE table_name = 'contratantes';
Verificar Pol√≠ticas Ativas:SELECT * FROM pg_policies WHERE tablename = 'contratantes';

## Pol√≠ticas de Seguran√ßa (RLS) ‚Äî Contratantes (Organizado)

- Atualizado em: 20/11/2025
- Escopo: `public.contratantes` e Storage `client-logos`
- Objetivo: leitura p√∫blica (vitrine) e escrita restrita ao propriet√°rio (auth.uid = id).

### Estrutura de Dados

```sql
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

CREATE TABLE IF NOT EXISTS public.contratantes (
  id uuid NOT NULL PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  nome_fantasia text NULL,
  cnpj text NULL,
  endereco text NULL,
  phone text NULL,
  email text NULL,
  description text NULL,
  logo_url text NULL,
  cover_url text NULL,
  specialties text[] NULL,
  opening_hours jsonb NULL,
  payment_data jsonb NULL,
  documents jsonb NULL,
  reviews jsonb NULL,
  created_at timestamptz NOT NULL DEFAULT now(),
  updated_at timestamptz NULL
);

CREATE INDEX IF NOT EXISTS idx_contratantes_nome ON public.contratantes (nome_fantasia);
```

### Pol√≠ticas RLS

```sql
ALTER TABLE public.contratantes ENABLE ROW LEVEL SECURITY;

-- Limpeza de pol√≠ticas antigas
DROP POLICY IF EXISTS "Permitir Proprietario Atualizar" ON public.contratantes;
DROP POLICY IF EXISTS "Permitir Leitura Proprietario" ON public.contratantes;
DROP POLICY IF EXISTS "Contratantes can insert their own data" ON public.contratantes;
DROP POLICY IF EXISTS "Enable read/write access for authenticated users" ON public.contratantes;

-- Escrita pelo propriet√°rio
CREATE POLICY "Proprietario Pode Escrever (FULL)"
ON public.contratantes FOR ALL
TO authenticated
USING ( auth.uid() = id )
WITH CHECK ( auth.uid() = id );

-- Leitura p√∫blica (vitrine)
CREATE POLICY "Leitura Publica (Vitrine)"
ON public.contratantes FOR SELECT
USING ( true );
```

### Automa√ß√£o (Triggers)

```sql
DROP TRIGGER IF EXISTS on_auth_user_created ON auth.users;
DROP FUNCTION IF EXISTS public.handle_new_user();
DROP FUNCTION IF EXISTS public.handle_new_user CASCADE;
```

### Storage: `client-logos`

```sql
INSERT INTO storage.buckets (id, name, public, file_size_limit, allowed_mime_types)
VALUES ('client-logos', 'client-logos', true, 5242880,
        ARRAY['image/png', 'image/jpeg', 'image/jpg', 'image/webp'])
ON CONFLICT (id) DO UPDATE SET public = true;

CREATE POLICY "Ver Imagens Publicamente"
ON storage.objects FOR SELECT
USING ( bucket_id = 'client-logos' );

CREATE POLICY "Proprietario Gerencia Imagens"
ON storage.objects FOR ALL
TO authenticated
USING ( bucket_id = 'client-logos' )
WITH CHECK ( bucket_id = 'client-logos' );
```

### Diagn√≥stico

```sql
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_name = 'contratantes';

SELECT * FROM pg_policies WHERE tablename = 'contratantes';
```
Auditoria no fluxo de dados

1. Mapeamento de Relacionamentos (Quem liga com quem?)


| table_schema | constraint_name                           | table_name           | column_name     | foreign_table_name  | foreign_column_name |
| ------------ | ----------------------------------------- | -------------------- | --------------- | ------------------- | ------------------- |
| public       | servicos_realizados_professional_id_fkey  | servicos_realizados  | professional_id | professionals       | id                  |
| public       | agendamentos_professional_id_fkey         | agendamentos         | professional_id | professionals       | id                  |
| public       | anuncios_de_servicos_professional_id_fkey | anuncios_de_servicos | professional_id | professionals       | id                  |
| public       | conversas_servico_id_fkey                 | conversas            | servico_id      | servicos_realizados | id                  |
| public       | mensagens_conversa_id_fkey                | mensagens            | conversa_id     | conversas           | id                  |
| public       | experiences_categoria_id_fkey             | experiences          | categoria_id    | categorias          | id                  |
| public       | experiences_regiao_id_fkey                | experiences          | regiao_id       | regioes             | id                  |
| public       | bookings_user_id_fkey                     | agendamentos         | id_contratante  | users               | id                  |
| public       | avaliacoes_professional_id_fkey           | avaliacoes           | professional_id | professionals       | id                  |
| public       | servicos_realizados_id_profissional_fkey  | servicos_realizados  | id_profissional | professionals       | id                  |
| public       | servicos_realizados_id_contratante_fkey   | servicos_realizados  | id_contratante  | contratantes        | id                  |
| public       | avaliacoes_id_servico_fkey                | avaliacoes           | id_servico      | servicos_realizados | id                  |
| public       | avaliacoes_id_avaliador_fkey              | avaliacoes           | id_avaliador    | contratantes        | id                  |
| public       | avaliacoes_id_avaliado_fkey               | avaliacoes           | id_avaliado     | professionals       | id                  |
| public       | contratantes_id_fkey                      | contratantes         | id              | profiles            | id                  |
| public       | auctions_creator_id_fkey                  | auctions             | creator_id      | profiles            | id                  |
| public       | auctions_category_id_fkey                 | auctions             | category_id     | categorias          | id                  |
| public       | auctions_winner_id_fkey                   | auctions             | winner_id       | profiles            | id                  |
| public       | bids_auction_id_fkey                      | bids                 | auction_id      | auctions            | id                  |
| public       | bids_bidder_id_fkey                       | bids                 | bidder_id       | profiles            | id                  |
| public       | experiences_professional_id_fkey          | experiences          | professional_id | professionals       | id                  |


2.O Detetive de Triggers (Automa√ß√µes Ocultas)

| Tabela Alvo  | Nome do Gatilho               | Evento (INSERT/UPDATE) | O que ele faz (Fun√ß√£o)                        |
| ------------ | ----------------------------- | ---------------------- | --------------------------------------------- |
| agendamentos | update_bookings_updated_at    | UPDATE                 | EXECUTE FUNCTION update_updated_at_column()   |
| avaliacoes   | tr_update_professional_rating | UPDATE                 | EXECUTE FUNCTION update_professional_rating() |
| avaliacoes   | tr_update_professional_rating | INSERT                 | EXECUTE FUNCTION update_professional_rating() |
| avaliacoes   | tr_update_professional_rating | DELETE                 | EXECUTE FUNCTION update_professional_rating() |
| categorias   | update_categories_updated_at  | UPDATE                 | EXECUTE FUNCTION update_updated_at_column()   |
| experiences  | update_experiences_updated_at | UPDATE                 | EXECUTE FUNCTION update_updated_at_column()   |
| regioes      | update_regioes_updated_at     | UPDATE                 | EXECUTE FUNCTION update_updated_at_column()   |
| users        | update_users_updated_at       | UPDATE                 | EXECUTE FUNCTION update_updated_at_column()   |


3. Auditoria de Seguran√ßa RLS (Quem pode fazer o qu√™?)


| Tabela               | Nome da Regra                                                  | A√ß√£o Permitida (SELECT/ALL...) | Para Quem (Auth/Public) | Regra de Leitura (USING)                                                                                                                                                                                | Regra de Escrita (WITH CHECK)                                                                                                                                                                                                             |
| -------------------- | -------------------------------------------------------------- | ------------------------------ | ----------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| agendamentos         | Usu√°rios podem deletar seus pr√≥prios agendamentos              | DELETE                         | {public}                | (auth.uid() = id_contratante)                                                                                                                                                                           | null                                                                                                                                                                                                                                      |
| agendamentos         | Profissionais podem criar agendamentos para si mesmos          | INSERT                         | {public}                | null                                                                                                                                                                                                    | (auth.uid() = professional_id)                                                                                                                                                                                                            |
| agendamentos         | Usu√°rios podem criar agendamentos                              | INSERT                         | {public}                | null                                                                                                                                                                                                    | (auth.uid() = id_contratante)                                                                                                                                                                                                             |
| agendamentos         | Profissionais podem ver os seus pr√≥prios agendamentos          | SELECT                         | {public}                | (auth.uid() = professional_id)                                                                                                                                                                          | null                                                                                                                                                                                                                                      |
| agendamentos         | Usu√°rios podem ver seus pr√≥prios agendamentos                  | SELECT                         | {public}                | (auth.uid() = id_contratante)                                                                                                                                                                           | null                                                                                                                                                                                                                                      |
| agendamentos         | Usu√°rios podem atualizar seus pr√≥prios agendamentos            | UPDATE                         | {public}                | (auth.uid() = id_contratante)                                                                                                                                                                           | null                                                                                                                                                                                                                                      |
| anuncios_de_servicos | Profissionais podem gerir os seus pr√≥prios an√∫ncios            | ALL                            | {public}                | (auth.uid() = professional_id)                                                                                                                                                                          | (auth.uid() = professional_id)                                                                                                                                                                                                            |
| anuncios_de_servicos | An√∫ncios s√£o p√∫blicos para leitura                             | SELECT                         | {public}                | true                                                                                                                                                                                                    | null                                                                                                                                                                                                                                      |
| auctions             | Allow creator to manage their own auction                      | ALL                            | {authenticated}         | (auth.uid() = creator_id)                                                                                                                                                                               | (auth.uid() = creator_id)                                                                                                                                                                                                                 |
| auctions             | Users can create auctions.                                     | INSERT                         | {authenticated}         | null                                                                                                                                                                                                    | (auth.role() = 'authenticated'::text)                                                                                                                                                                                                     |
| auctions             | Public auctions are viewable by everyone.                      | SELECT                         | {public}                | true                                                                                                                                                                                                    | null                                                                                                                                                                                                                                      |
| auctions             | Allow authenticated users to view all auctions                 | SELECT                         | {authenticated}         | true                                                                                                                                                                                                    | null                                                                                                                                                                                                                                      |
| auctions             | Users can update their own auctions.                           | UPDATE                         | {public}                | (auth.uid() = creator_id)                                                                                                                                                                               | (auth.uid() = creator_id)                                                                                                                                                                                                                 |
| avaliacoes           | Public read access for avaliacoes                              | SELECT                         | {public}                | true                                                                                                                                                                                                    | null                                                                                                                                                                                                                                      |
| bids                 | Allow bidder to manage their own bid                           | ALL                            | {authenticated}         | (auth.uid() = bidder_id)                                                                                                                                                                                | (auth.uid() = bidder_id)                                                                                                                                                                                                                  |
| bids                 | Users can place bids.                                          | INSERT                         | {public}                | null                                                                                                                                                                                                    | (auth.role() = 'authenticated'::text)                                                                                                                                                                                                     |
| bids                 | Bids are viewable by everyone.                                 | SELECT                         | {public}                | true                                                                                                                                                                                                    | null                                                                                                                                                                                                                                      |
| bids                 | Bids cannot be updated.                                        | UPDATE                         | {public}                | false                                                                                                                                                                                                   | null                                                                                                                                                                                                                                      |
| categorias           | Categories s√£o vis√≠veis para todos                             | SELECT                         | {public}                | true                                                                                                                                                                                                    | null                                                                                                                                                                                                                                      |
| contratantes         | Proprietario Pode Escrever (FULL)                              | ALL                            | {authenticated}         | (auth.uid() = id)                                                                                                                                                                                       | (auth.uid() = id)                                                                                                                                                                                                                         |
| contratantes         | Leitura Publica (Vitrine)                                      | SELECT                         | {public}                | true                                                                                                                                                                                                    | null                                                                                                                                                                                                                                      |
| contratantes         | RLS: Leitura Publica                                           | SELECT                         | {public}                | true                                                                                                                                                                                                    | null                                                                                                                                                                                                                                      |
| conversas            | Permitir leitura para participantes da conversa                | SELECT                         | {authenticated}         | ((auth.uid() = contratante_id) OR (auth.uid() = prestador_id))                                                                                                                                          | null                                                                                                                                                                                                                                      |
| experiences          | Experi√™ncias s√£o vis√≠veis para todos                           | SELECT                         | {public}                | true                                                                                                                                                                                                    | null                                                                                                                                                                                                                                      |
| mensagens            | Permitir inser√ß√£o de mensagens para participantes              | INSERT                         | {authenticated}         | null                                                                                                                                                                                                    | ((remetente_id = auth.uid()) AND (( SELECT mensagens.conversa_id
   FROM conversas
  WHERE ((conversas.id = mensagens.conversa_id) AND ((auth.uid() = conversas.contratante_id) OR (auth.uid() = conversas.prestador_id)))) IS NOT NULL)) |
| mensagens            | Permitir leitura de mensagens para participantes               | SELECT                         | {authenticated}         | (( SELECT mensagens.conversa_id
   FROM conversas
  WHERE ((conversas.id = mensagens.conversa_id) AND ((auth.uid() = conversas.contratante_id) OR (auth.uid() = conversas.prestador_id)))) IS NOT NULL) | null                                                                                                                                                                                                                                      |
| professionals        | Permitir que utilizadores autenticados criem o seu pr√≥prio per | INSERT                         | {authenticated}         | null                                                                                                                                                                                                    | (auth.uid() = id)                                                                                                                                                                                                                         |
| professionals        | Perfis s√£o vis√≠veis para todos                                 | SELECT                         | {public}                | true                                                                                                                                                                                                    | null                                                                                                                                                                                                                                      |
| professionals        | Permitir que o dono do perfil o atualize                       | UPDATE                         | {public}                | (auth.uid() = id)                                                                                                                                                                                       | (auth.uid() = id)                                                                                                                                                                                                                         |
| profiles             | Usu√°rios podem criar seu pr√≥prio perfil                        | INSERT                         | {authenticated}         | null                                                                                                                                                                                                    | (auth.uid() = id)                                                                                                                                                                                                                         |
| profiles             | Perfis s√£o vis√≠veis para todos autenticados                    | SELECT                         | {authenticated}         | true                                                                                                                                                                                                    | null                                                                                                                                                                                                                                      |
| profiles             | Usu√°rios podem atualizar seu pr√≥prio perfil                    | UPDATE                         | {authenticated}         | (auth.uid() = id)                                                                                                                                                                                       | null                                                                                                                                                                                                                                      |
| regioes              | Regi√µes s√£o vis√≠veis para todos                                | SELECT                         | {public}                | true                                                                                                                                                                                                    | null                                                                                                                                                                                                                                      |
| servicos_realizados  | Permitir que contratantes criem seus pr√≥prios servi√ßos         | INSERT                         | {authenticated}         | null                                                                                                                                                                                                    | (auth.uid() = id_contratante)                                                                                                                                                                                                             |
| servicos_realizados  | Profissionais podem ver os seus pr√≥prios servi√ßos              | SELECT                         | {public}                | (auth.uid() = professional_id)                                                                                                                                                                          | null                                                                                                                                                                                                                                      |
| servicos_realizados  | Public read access for servicos_realizados                     | SELECT                         | {public}                | true                                                                                                                                                                                                    | null                                                                                                                                                                                                                                      |
| servicos_realizados  | Permitir que profissionais atualizem seus pr√≥prios servi√ßos    | UPDATE                         | {authenticated}         | (auth.uid() = professional_id)                                                                                                                                                                          | null                                                                                                                                                                                                                                      |
| users                | Usu√°rios podem inserir seus pr√≥prios dados                     | INSERT                         | {public}                | null                                                                                                                                                                                                    | (auth.uid() = id)                                                                                                                                                                                                                         |
| users                | Usu√°rios podem ver seus pr√≥prios dados                         | SELECT                         | {public}                | (auth.uid() = id)                                                                                                                                                                                       | null                                                                                                                                                                                                                                      |
| users                | Usu√°rios podem atualizar seus pr√≥prios dados                   | UPDATE                         | {public}                | (auth.uid() = id)                                                                                                                                                                                       | null                                                                                                                                                                                                                                      |

4. fluxo de contrata√ß√£o:

| Tabela              | Coluna                        | Tipo de Dado             | Obrigat√≥rio? |
| ------------------- | ----------------------------- | ------------------------ | ------------ |
| auctions            | id                            | uuid                     | NO           |
| auctions            | creator_id                    | uuid                     | NO           |
| auctions            | category_id                   | uuid                     | YES          |
| auctions            | title                         | character varying        | NO           |
| auctions            | description                   | text                     | YES          |
| auctions            | base_price                    | numeric                  | NO           |
| auctions            | end_date                      | timestamp with time zone | NO           |
| auctions            | status                        | character varying        | YES          |
| auctions            | winner_id                     | uuid                     | YES          |
| auctions            | created_at                    | timestamp with time zone | YES          |
| auctions            | updated_at                    | timestamp with time zone | YES          |
| auctions            | winning_professional_id       | uuid                     | YES          |
| auctions            | auction_start_date            | timestamp with time zone | YES          |
| auctions            | current_highest_bid_amount    | numeric                  | YES          |
| bids                | id                            | uuid                     | NO           |
| bids                | auction_id                    | uuid                     | NO           |
| bids                | bidder_id                     | uuid                     | NO           |
| bids                | bid_amount                    | numeric                  | NO           |
| bids                | created_at                    | timestamp with time zone | YES          |
| bids                | bid_time                      | timestamp with time zone | YES          |
| servicos_realizados | id                            | uuid                     | NO           |
| servicos_realizados | id_profissional               | uuid                     | YES          |
| servicos_realizados | id_contratante                | uuid                     | YES          |
| servicos_realizados | data_servico                  | date                     | YES          |
| servicos_realizados | tipo_servico                  | character varying        | YES          |
| servicos_realizados | valor                         | numeric                  | YES          |
| servicos_realizados | status                        | character varying        | YES          |
| servicos_realizados | data_criacao                  | timestamp with time zone | YES          |
| servicos_realizados | professional_id               | uuid                     | YES          |
| servicos_realizados | service_latitude              | numeric                  | YES          |
| servicos_realizados | service_longitude             | numeric                  | YES          |
| servicos_realizados | check_in_time                 | timestamp with time zone | YES          |
| servicos_realizados | check_out_time                | timestamp with time zone | YES          |
| servicos_realizados | distancia_km                  | numeric                  | YES          |
| servicos_realizados | contratacao_status            | USER-DEFINED             | YES          |
| servicos_realizados | status_visualizacao_prestador | text                     | NO           |
| servicos_realizados | hora_inicio                   | time without time zone   | YES          |
| servicos_realizados | hora_fim                      | time without time zone   | YES          |
| servicos_realizados | checklist_alinhamento         | jsonb                    | YES          |
| servicos_realizados | expira_em                     | timestamp with time zone | YES          |

